<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NewTon DC - Tournament Manager</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="container">
        <div class="header">
            <div class="header-top">
                <h1>
                    <div class="logo-placeholder">
                        CLUB<br>LOGO
                    </div>
                    NewTon DC - Tournament Manager
                </h1>
            </div>
            <div class="nav">
                <button class="nav-btn active" data-page="setup">Setup</button>
                <button class="nav-btn" data-page="registration">Registration</button>
                <button class="nav-btn" data-page="tournament">Tournament</button>
                <button class="nav-btn" data-page="config">Config</button>
            </div>
        </div>

        <!-- Setup Page -->
        <div id="setup" class="page active">
            <h2>Tournament Setup</h2>
            <div class="tournament-info">
                <div class="form-group">
                    <label for="tournamentName">Tournament Name</label>
                    <input type="text" id="tournamentName" placeholder="Enter tournament name">
                </div>
                <div class="form-group" style="max-width: 250px;">
                    <label for="tournamentDate">Tournament Date</label>
                    <input type="date" id="tournamentDate">
                </div>
            </div>

            <div class="form-group">
                <button class="btn btn-success" onclick="createTournament()">Create New Tournament</button>
                <button class="btn btn-warning" onclick="exportTournament()">Export Tournament</button>
		    <button class="btn" onclick="document.getElementById('importFile').click()">Import Tournament</button>
    		    <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importTournament(event)">
            </div>

            <div id="tournamentStatus" class="alert alert-info"">
    		No active tournament
    	    </div>

	    <div id="importStatus" class="alert" style="display: none; margin-top: 10px;">
    		<!-- Import status messages will appear here -->
	    </div>

    <div class=" config-section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h3>Recent Tournaments</h3>
                    <button class="btn" id="toggleTournamentsBtn" onclick="toggleTournamentView()"
                        style="padding: 5px 15px; font-size: 14px;">Show All</button>
                </div>
                <div id="recentTournaments">
                    <p>No tournaments found</p>
                </div>
            </div>
        </div>

        <!-- Registration Page -->
        <div id="registration" class="page">
            <h2>Player Registration</h2>

            <div class="form-group">
                <label for="playerName">Add New Player</label>
                <div style="display: flex; gap: 10px;">
                    <input type="text" id="playerName" placeholder="Enter player name" style="flex: 1;">
                    <button class="btn btn-success" onclick="addPlayer()">Add Player</button>
                </div>
            </div>

            <div style="display: flex; justify-content: space-between; align-items: center; margin: 20px 0;">
                <h3>Players (<span id="playerCount">0</span> total, <span id="paidCount">0</span> paid)</h3>
                <div>
                    <button class="btn" onclick="generateBracket()">Generate Bracket</button>
                    <button class="btn btn-danger" onclick="clearAllPlayers()">Clear All</button>
                </div>
            </div>

            <div id="playersContainer" class="players-grid">
                <!-- Players will be added here -->
            </div>

            <!-- Results Section - NOW VISIBLE -->
            <div id="resultsSection" style="margin-top: 40px;">
                <h3 id="resultsTitle">Current Points</h3>
                <table class="results-table">
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Player</th>
                            <th>Points</th>
                            <th>Short Legs</th>
                            <th>High Outs</th>
                            <th>Tons</th>
                            <th>180s</th>
                        </tr>
                    </thead>
                    <tbody id="resultsTableBody">
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Tournament Page -->
        <div id="tournament" class="page">
            <h2>Double Elimination Bracket</h2>

            <div id="tournamentControls" style="margin-bottom: 20px;">
                <button class="btn" onclick="autoAssignReferees()">Auto-Assign Referees</button>
                <button class="btn btn-warning" onclick="resetTournament()">Reset Tournament</button>
                <button class="btn" onclick="showMatchDetails()">Match Details</button>
            </div>

            <div class="bracket-container">
                <div class="bracket-controls">
		    <button class="zoom-btn" id="undoBtn" onclick="handleUndoClick()" title="No matches to undo" disabled>↶</button>
                    <button class="zoom-btn" onclick="zoomOut()" title="Zoom Out">−</button>
                    <button class="zoom-btn" onclick="resetZoom()" title="Reset Zoom">⌂</button>
                    <button class="zoom-btn" onclick="zoomIn()" title="Zoom In">+</button>
                </div>

                <div class="bracket-viewport" id="bracketViewport">
                    <div class="bracket-canvas" id="bracketCanvas">
                        <div class="bracket-title back">BACKSIDE</div>
                        <div class="bracket-title front">FRONTSIDE</div>

                        <div id="bracketMatches">
                            <!-- Bracket matches will be rendered here -->
                        </div>

                        <div id="bracketLines">
                            <!-- Connection lines will be rendered here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Configuration Page -->
        <div id="config" class="page">
            <h2>Tournament Configuration</h2>

            <div class="config-section">
                <h3>Application Settings</h3>
                <div class="config-grid">
                    <div class="form-group">
                        <label for="applicationTitle">Application Title</label>
                        <input type="text" id="applicationTitle" value="NewTon DC - Tournament Manager"
                            placeholder="Your Club - Tournament Manager">
                    </div>
                </div>
                <button class="btn btn-success" onclick="saveApplicationSettings()">Save Application Settings</button>
            </div>

            <div class="config-section">
                <h3>Point Values</h3>
                <div class="config-grid">
                    <div class="form-group">
                        <label for="participationPoints">Participation Points</label>
                        <input type="number" id="participationPoints" value="1" min="0">
                    </div>
                    <div class="form-group">
                        <label for="firstPlacePoints">1st Place Points</label>
                        <input type="number" id="firstPlacePoints" value="3" min="0">
                    </div>
                    <div class="form-group">
                        <label for="secondPlacePoints">2nd Place Points</label>
                        <input type="number" id="secondPlacePoints" value="2" min="0">
                    </div>
                    <div class="form-group">
                        <label for="thirdPlacePoints">3rd Place Points</label>
                        <input type="number" id="thirdPlacePoints" value="1" min="0">
                    </div>
                    <div class="form-group">
                        <label for="highOutPoints">High Out Points (101+)</label>
                        <input type="number" id="highOutPoints" value="1" min="0">
                    </div>
                    <div class="form-group">
                        <label for="tonPoints">Ton Points (100+)</label>
                        <input type="number" id="tonPoints" value="0" min="0">
                    </div>
                    <div class="form-group">
                        <label for="shortLegPoints">Short Leg Points</label>
                        <input type="number" id="shortLegPoints" value="1" min="0">
                    </div>
                    <div class="form-group">
                        <label for="oneEightyPoints">180 Points</label>
                        <input type="number" id="oneEightyPoints" value="1" min="0">
                    </div>
                </div>
            </div>

            <div class="config-section">
                <h3>Match Configuration</h3>
                <div class="config-grid">
                    <div class="form-group">
                        <label for="regularRoundsLegs">Regular Rounds</label>
                        <select id="regularRoundsLegs">
                            <option value="3" selected>Best of 3</option>
                            <option value="5">Best of 5</option>
                            <option value="7">Best of 7</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="semiFinalLegs">Semi-Finals</label>
                        <select id="semiFinalsLegs">
                            <option value="3" selected>Best of 3</option>
                            <option value="5">Best of 5</option>
                            <option value="7">Best of 7</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="backsideFinalLegs">Backside Final</label>
                        <select id="backsideFinalLegs">
                            <option value="3">Best of 3</option>
                            <option value="5" selected>Best of 5</option>
                            <option value="7">Best of 7</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="grandFinalLegs">Grand Final</label>
                        <select id="grandFinalLegs">
                            <option value="3">Best of 3</option>
                            <option value="5" selected>Best of 5</option>
                            <option value="7">Best of 7</option>
                        </select>
                    </div>
                </div>
                <button class="btn btn-success" onclick="saveConfiguration()">Save Point & Match Settings</button>
            </div>

            <div class="config-section">
                <h3>Lane Management</h3>
                <div class="config-grid">
                    <div class="form-group">
                        <label for="maxLanes">Maximum Number of Lanes</label>
                        <select id="maxLanes">
                            <option value="1">1 Lane</option>
                            <option value="2">2 Lanes</option>
                            <option value="3">3 Lanes</option>
                            <option value="4" selected>4 Lanes</option>
                            <option value="5">5 Lanes</option>
                            <option value="6">6 Lanes</option>
                            <option value="7">7 Lanes</option>
                            <option value="8">8 Lanes</option>
                            <option value="9">9 Lanes</option>
                            <option value="10">10 Lanes</option>
                            <option value="11">11 Lanes</option>
                            <option value="12">12 Lanes</option>
                            <option value="13">13 Lanes</option>
                            <option value="14">14 Lanes</option>
                            <option value="15">15 Lanes</option>
                            <option value="16">16 Lanes</option>
                            <option value="17">17 Lanes</option>
                            <option value="18">18 Lanes</option>
                            <option value="19">19 Lanes</option>
                            <option value="20">20 Lanes</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="requireLaneForStart" style="margin-right: 8px;">
                            Require lane assignment before starting match
                        </label>
                    </div>
                </div>
                <button class="btn btn-success" onclick="updateLaneConfiguration()">Save Lane Settings</button>
                <button class="btn" onclick="showLaneUsage()">Show Current Lane Usage</button>
            </div>

            <div class="config-section">
                <h3>User Interface</h3>
                <div class="config-grid">
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="confirmWinnerSelection" checked style="margin-right: 8px;">
                            Show confirmation dialog when selecting match winner
                        </label>
                    </div>
                </div>
                <button class="btn btn-success" onclick="saveUIConfiguration()">Save UI Settings</button>
            </div>
        </div>
    </div>

    <!-- Statistics Modal -->
    <div id="statsModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeStatsModal()">&times;</span>
            <h3 id="statsPlayerName">Player Statistics</h3>
            <div class="form-group">
                <label>Short Legs (max 21 darts)</label>
                <input type="number" id="statsShortLegs" min="0" max="21">
            </div>
            <div class="form-group">
                <label>High Out Score (101+)</label>
                <input type="number" id="statsHighOut" min="101" max="170">
                <button class="btn" onclick="addHighOut()">Add High Out</button>
            </div>
            <div class="form-group">
                <label>Tons (100+)</label>
                <input type="number" id="statsTons" min="0">
            </div>
            <div class="form-group">
                <label>180s</label>
                <input type="number" id="stats180s" min="0">
            </div>
            <div id="highOutsList" style="margin-top: 10px;"></div>
            <div style="margin-top: 20px;">
                <button class="btn btn-success" onclick="saveStats()">Save Statistics</button>
                <button class="btn" onclick="closeStatsModal()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Load JavaScript files in the correct order -->
    <script src="main.js"></script>
    <script src="lane-management.js"></script>
    <script src="tournament-management.js"></script>
    <script src="player-management.js"></script>
    <script src="clean-match-progression.js"></script>
    <script src="bracket-rendering.js"></script>
    <script src="tournament-controls.js"></script>
    <script src="results-config.js"></script>

    <footer
        style="text-align: center; padding: 20px; color: #666; font-size: 14px; border-top: 1px solid #ddd; margin-top: 20px; background: white;">
        Created by Håvard Skrödahl - NewTon DC Malmö
    </footer>

    <!-- Winner Confirmation Modal -->
    <div id="winnerConfirmModal" class="modal">
        <div class="modal-content">
            <h3 id="winnerConfirmTitle">Confirm Match Winner</h3>
            <div id="winnerConfirmMessage" style="margin: 20px 0; line-height: 1.5;">
                <!-- Message will be populated by JavaScript -->
            </div>
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn" id="winnerConfirmCancel" style="margin-right: 15px; background: #6c757d;">Cancel</button>
                <button class="btn btn-success" id="winnerConfirmOK">Confirm Winner</button>
            </div>
        </div>
    </div>
</body>

</html>
